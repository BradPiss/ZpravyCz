{% extends "base.html" %}

{% block title %}{{ article.title }} | Zprávy.cz{% endblock %}

{% block content %}
<article class="article-page page-container">
    
    <a href="/" class="back-btn" style="display:inline-flex; align-items:center; gap:8px; color:var(--blue); font-weight:600; font-size:15px; text-decoration:none; margin-top: 20px; margin-bottom:24px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42-.39-.39-1.02-.39-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1z"/>
        </svg>
        <span>Zpět na hlavní stránku</span>
    </a>

    <div class="article-meta" style="display:flex; align-items:center; gap:12px; margin-bottom:8px; flex-wrap:wrap; min-height: 30px;">
        
        <span class="news-time" style="display:flex; align-items:center; justify-content:center; padding: 4px 8px; margin:0; font-size:12px; border-radius:4px; line-height: 1.2;">
            {{ article.created_at | format_date }}
        </span>
        
        <span class="article-category" style="display:flex; align-items:center; font-size:13px; font-weight:700; text-transform:uppercase; color:var(--blue); margin:0; line-height: 1.2;">
            {% if article.category %}
            <a href="{{ url_for('category_detail', category_id=article.category.id) }}" style="text-decoration:none; color:inherit;">
                {{ article.category.name }}
            </a>
            {% else %}
            Zprávy
            {% endif %}
        </span>
        
        <span class="article-author" style="display:flex; align-items:center; font-size:14px; color:var(--muted); margin:0; line-height: 1.2;">
            {{ article.author.name }}
        </span>

        <button class="fav-btn" data-article-id="{{ article.id }}"
                style="margin-left:4px; margin-bottom:2px; background:none; border:0; cursor:pointer; display:flex; align-items:center; justify-content:center; padding:0; color:var(--blue);"
                title="Přidat do oblíbených">
            
            <span id="fav-icon" style="display:flex; align-items:center;">
                {% if user and article in user.saved_articles_rel %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#ef4444" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                {% endif %}
            </span>
        </button>
    </div>

    <h1 class="article-title" style="font-size:38px; font-weight:800; line-height:1.15; color:var(--text); margin:0 0 24px 0;">
        {{ article.title }}
    </h1>

    <div class="article-lead" style="font-size:18px; line-height:1.6; color:var(--preview-text); margin-bottom:32px; font-weight:500;">
        {{ article.perex }}
    </div>

    {% if article.image_url %}
    <img class="article-image" src="{{ article.image_url }}" alt="{{ article.title }}" 
         style="width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:10px; margin-bottom:16px;">
    <p class="article-image-caption" style="font-size:13px; color:var(--muted); font-style:italic; margin-bottom:40px;">
        {{ article.image_caption if article.image_caption else 'Ilustrační snímek' }}
    </p>
    {% endif %}

    <div class="article-content" style="font-size:17px; line-height:1.75; color:var(--text);">
        {{ article.content | safe }}
    </div>

    <div style="margin-top:48px; padding-top:32px; border-top:1px solid var(--border);">
        
        {% if article.tags %}
        <div class="article-tags-wrapper" style="border:0; padding:0; margin:0 0 32px 0;">
            <span class="tags-label">Témata:</span>
            <div class="tags-list">
                {% for tag in article.tags %}
                <a href="/hledat?q={{ tag.name }}" class="article-tag">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div style="display:flex; justify-content:space-between; align-items:center; background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:20px;">
            <div>
                <h3 style="font-size:20px; font-weight:800; margin:0 0 4px 0;">Diskuse ({{total_count}})</h3>
                <p style="color:var(--muted); margin:0; font-size:14px;">Zapojte se do debaty k článku.</p>
            </div>
            
            <a href="/clanek/{{ article.id }}/diskuse" style="background:var(--bg); border:2px solid var(--border); color:var(--text); padding:10px 20px; border-radius:6px; font-weight:700; text-decoration:none; transition:all 0.2s ease; display:inline-flex; align-items:center; gap:8px;">
                <span>Vstoupit do diskuse</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <polyline points="13 5 21 12 13 19"></polyline>
                </svg>
            </a>
        </div>

    </div>

    {% if related_articles %}
    <div class="related-articles" style="margin-top:60px; padding-top:40px; border-top:2px solid var(--border);">
        <h2 class="related-title" style="font-size:24px; font-weight:800; color:var(--text); margin-bottom:28px;">
            Související články
        </h2>
        <div class="related-grid" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:24px;">
            {% for rel in related_articles %}
            <div class="related-card">
                <a href="{{ url_for('article_detail', article_id=rel.id) }}" style="text-decoration:none;">
                    <img src="{{ rel.image_url }}" alt="{{ rel.title }}" style="width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:8px; margin-bottom:12px;">
                    <div class="related-card-time" style="font-size:12px; color:var(--muted); margin-bottom:8px;">
                        {{ rel.created_at | format_date }}
                    </div>
                    <div class="related-card-title" style="font-size:16px; font-weight:700; line-height:1.3; color:var(--blue);">
                        {{ rel.title }}
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</article>

<script>
    const heartIcons = {
        filled: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#ef4444" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
        outline: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>'
    };

    // Najdeme tlačítko a přidáme event listener
    const favBtn = document.querySelector('.fav-btn');
    if (favBtn) {
        favBtn.addEventListener('click', async function() {
            const articleId = this.getAttribute('data-article-id');
            
            try {
                // Odeslání požadavku
                const response = await fetch('/clanek/' + articleId + '/oblibit', { 
                    method: 'POST' 
                });
                
                // Pokud není přihlášen -> otevřít login
                if (response.status === 401) {
                    const signinBtn = document.getElementById('signinBtn');
                    if (signinBtn) signinBtn.click();
                    return;
                }

                // Zpracování odpovědi
                const data = await response.json();
                const iconContainer = document.getElementById('fav-icon');
                
                if (data.action === 'added') {
                    iconContainer.innerHTML = heartIcons.filled;
                } else {
                    iconContainer.innerHTML = heartIcons.outline;
                }
            } catch (error) {
                console.error('Chyba:', error);
            }
        });
    }
</script>
{% endblock %}