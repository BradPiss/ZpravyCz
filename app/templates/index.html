{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}

{% if main_article %}
<section class="main-article-grid" style="display:grid;grid-template-columns:0.8fr 1fr;gap:32px;margin-bottom:40px;align-items:start">
  <div class="clickable-area">
    <a href="{{ url_for('article_detail', article_id=main_article.id) }}">
      <img class="img-main" src="{{ main_article.image_url }}" alt="{{ main_article.title }}" 
           style="width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:8px;">
    </a>
  </div>
  <div style="padding-top:4px">
    <div style="margin-bottom:10px">
        <span class="news-time">{{ main_article.created_at | format_date }}</span>
    </div>
    <div class="clickable-area">
      <h1>
          <a href="{{ url_for('article_detail', article_id=main_article.id) }}" class="headline-main" style="font-size:30px;font-weight:800;line-height:1.1;margin:0 0 16px;display:block;color:var(--blue);text-decoration:none;">
              {{ main_article.title }}
          </a>
      </h1>
    </div>
    <p style="color:var(--preview-text);font-size:15.5px;line-height:1.6;">
        {{ main_article.perex }} 
        <a href="{{ url_for('article_detail', article_id=main_article.id) }}" class="read-more-link" style="color:var(--blue);font-weight:700;text-decoration:none;">Celý článek</a>
    </p>
  </div>
</section>
{% endif %}

{% if promoted_articles | select("ne", none) | list | length > 0 %}
<section class="secondary-grid" style="display:grid;grid-template-columns:repeat(3, 1fr);gap:28px;margin-bottom:50px">
  {% for article in promoted_articles %}
    {% if article %}
      <article>
        <div class="clickable-area">
          <a href="{{ url_for('article_detail', article_id=article.id) }}">
              <img class="img-thumb" src="{{ article.image_url }}" alt="{{ article.title }}" 
                   style="width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:8px;">
          </a>
          <div style="margin-top:10px">
              <span class="news-time">{{ article.created_at | format_date }}</span>
          </div>
          <h2>
              <a href="{{ url_for('article_detail', article_id=article.id) }}" class="headline-sub" style="font-size:18px;font-weight:800;margin:8px 0;display:block;color:var(--blue);text-decoration:none;">
                  {{ article.title }}
              </a>
          </h2>
        </div>
        <p style="color:var(--preview-text);font-size:14px;line-height:1.5;">
            {{ article.perex[:90] }}...
        </p>
      </article>
    {% else %}
      <div class="empty-slot"></div>
    {% endif %}
  {% endfor %}
</section>
{% endif %}

<section style="margin-top:60px">
  <div class="news-support-container">
    
    <div class="news-list-wrapper">
      <h2 class="section-title">Další zprávy</h2>
      
      <div id="newsList">
        {% for article in list_articles %}
        <article class="list-article {% if loop.index0 >= 6 %}hidden-article{% endif %}">
          <div style="flex:1">
            <div style="margin-bottom:8px">
                <span class="news-time">{{ article.created_at | format_date }}</span>
                {% if article.category %}
                <span style="color:var(--blue); font-weight:700; font-size:13px; text-transform:uppercase; margin-left:8px;">
                     <a href="{{ url_for('category_detail', category_id=article.category.id) }}" style="text-decoration:none; color:inherit;">
                        {{ article.category.name }}
                    </a>
                </span>
                {% endif %}
            </div>
            <div class="clickable-area">
              <a href="{{ url_for('article_detail', article_id=article.id) }}" style="text-decoration:none;">
                  <h3 class="headline-list">{{ article.title }}</h3>
              </a>
            </div>
            <p class="list-preview">
                {{ article.perex }}
            </p>
          </div>
          <div class="clickable-area">
            <a href="{{ url_for('article_detail', article_id=article.id) }}">
                <img class="img-list" src="{{ article.image_url }}" alt="{{ article.title }}" />
            </a>
          </div>
        </article>
        {% endfor %}
      </div>

      {% if list_articles|length > 6 %}
      <div class="load-more-wrapper" id="hpLoadMoreContainer" style="text-align:center; margin-top:32px">
            <button class="load-more-btn" id="hpLoadMoreBtn" style="margin: 0 auto;">
              <span>Zobrazit další</span>
              <span>▼</span>
            </button>
      </div>

      <script>
        document.getElementById('hpLoadMoreBtn').addEventListener('click', function() {
            const hidden = document.querySelectorAll('#newsList .hidden-article');
            const toShow = Array.from(hidden).slice(0, 6);
            toShow.forEach(el => el.classList.remove('hidden-article'));
            if (document.querySelectorAll('#newsList .hidden-article').length === 0) {
                document.getElementById('hpLoadMoreContainer').style.display = 'none';
            }
        });
      </script>
      {% endif %}
      
      {% if not list_articles %}
        <p style="color:var(--muted); padding:20px 0;">Žádné další zprávy.</p>
      {% endif %}

    </div>

    <aside class="support-box">
      <h3 class="support-title">Podpořte nás ❤️</h3> 
      <p class="support-description">
        Kvalitní obsah vzniká jen díky podpoře čtenářů, jako jste vy. Fungujeme bez reklam a silných investorů za zády. Váš příspěvek nám dává svobodu tvořit poctivě a udržet zprávy odemčené pro všechny.
      </p>
      
      <div class="payment-toggle">
        <button type="button" id="btn-one-time" class="active">Jednorázově</button>
        <button type="button" id="btn-monthly">Měsíčně</button>
      </div>
      
      <div class="amount-grid">
        <button type="button" class="amount-btn" onclick="setAmount(50)">50 Kč</button>
        <button type="button" class="amount-btn" onclick="setAmount(100)">100 Kč</button>
        <button type="button" class="amount-btn" onclick="setAmount(500)">500 Kč</button>
        <button type="button" class="amount-btn" onclick="setAmount(1000)">1000 Kč</button>
      </div>
      
      <input type="number" id="custom-amount-input" class="custom-amount" placeholder="Vlastní částka (Kč)" min="1">
      
      <button class="support-submit">Podpořit</button>
      
      <p class="support-note">
        Vaše podpora jde ze 100 % na provoz a rozvoj redakce.
      </p>
    </aside>
  </div>
</section>

<script>
    // Logika pro widget Podpora
    const btnOneTime = document.getElementById('btn-one-time');
    const btnMonthly = document.getElementById('btn-monthly');

    if(btnOneTime && btnMonthly) {
        btnOneTime.addEventListener('click', () => {
            btnOneTime.classList.add('active');
            btnMonthly.classList.remove('active');
        });
        btnMonthly.addEventListener('click', () => {
            btnMonthly.classList.add('active');
            btnOneTime.classList.remove('active');
        });
    }

    function setAmount(value) {
        const input = document.getElementById('custom-amount-input');
        if(input) {
            input.value = value;
            input.focus();
        }
    }
</script>
{% endblock %}