{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="page-container" style="max-width:800px;">
    
    <div style="margin-bottom:24px;">
        <a href="/admin/clanky" style="color:var(--muted); text-decoration:none;">← Zpět na seznam</a>
    </div>

    <h1 style="font-size:28px; font-weight:800; margin-bottom:30px;">{{ title }}</h1>

    <form method="post" style="display:flex; flex-direction:column; gap:20px;">
        
        <div>
            <label style="display:block; font-weight:700; margin-bottom:8px;">Nadpis článku</label>
            <input type="text" name="title" value="{{ article.title if article else '' }}" required
                   style="width:100%; padding:12px; border:1px solid var(--border); border-radius:6px; background:var(--bg); color:var(--text); font-size:16px;">
        </div>

        <div>
            <label style="display:block; font-weight:700; margin-bottom:8px;">URL Obrázku</label>
            <input type="url" name="image_url" value="{{ article.image_url if article and article.image_url else '' }}"
                   placeholder="https://..."
                   style="width:100%; padding:12px; border:1px solid var(--border); border-radius:6px; background:var(--bg); color:var(--text);">
        </div>

        <div>
            <label style="display:block; font-weight:700; margin-bottom:8px;">Popisek obrázku (nepovinné)</label>
            <input type="text" name="image_caption" value="{{ article.image_caption if article and article.image_caption else '' }}"
                   placeholder="Např. Pohled na novou stanici metra"
                   style="width:100%; padding:12px; border:1px solid var(--border); border-radius:6px; background:var(--bg); color:var(--text);">
            <p style="font-size:12px; color:var(--muted); margin-top:4px;">Pokud nevyplníte, zobrazí se "Ilustrační snímek"</p>
        </div>

        <div>
            <label style="display:block; font-weight:700; margin-bottom:8px;">Kategorie</label>
            <select name="category_id" style="width:100%; padding:12px; border:1px solid var(--border); border-radius:6px; background:var(--bg); color:var(--text);">
                {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if article and article.category_id == cat.id %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label style="display:block; font-weight:700; margin-bottom:8px;">Tagy (oddělené čárkou)</label>
            <input type="text" name="tags" 
                   value="{% if article %}{{ article.tags|map(attribute='name')|join(', ') }}{% endif %}"
                   placeholder="Např. sport, fotbal, finále"
                   style="width:100%; padding:12px; border:1px solid var(--border); border-radius:6px; background:var(--bg); color:var(--text);">
        </div>

        <div style="background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:20px;">
            
            <label style="display:block; font-weight:700; margin-bottom:12px;">Stav publikace</label>
            
            <select name="status" id="statusSelect" onchange="togglePositionSelector()" 
                    style="width:100%; padding:12px; border:1px solid var(--border); border-radius:6px; background:var(--bg); color:var(--text); margin-bottom:20px;">
                
                <option value="draft" {% if article and article.status.value == 'draft' %}selected{% endif %}>
                    Koncept (neveřejný)
                </option>

                {% if user.role.value in ['admin', 'chief_editor'] or (article and article.status.value == 'published') %}
                    <option value="published" {% if article and article.status.value == 'published' %}selected{% endif %} 
                            style="font-weight:bold; color:var(--blue);">
                         Vydáno (veřejné)
                    </option>
                {% endif %}
            </select>

            {% if user.role.value in ['admin', 'chief_editor'] %}
            <div id="positionSelectorWrapper" style="display:none;">
                <label style="display:block; font-weight:700; margin-bottom:12px;">Pozice na hlavní stránce</label>
                <input type="hidden" name="home_position" id="home_position" value="{{ article.home_position if article else 0 }}">

                <div class="layout-grid">
                    <div class="layout-item pos-main" onclick="selectPosition(1, this)" id="btn-pos-1">1. HLAVNÍ ZPRÁVA</div>
                    <div class="layout-row">
                        <div class="layout-item pos-sec" onclick="selectPosition(2, this)" id="btn-pos-2">2. Vlevo</div>
                        <div class="layout-item pos-sec" onclick="selectPosition(3, this)" id="btn-pos-3">3. Střed</div>
                        <div class="layout-item pos-sec" onclick="selectPosition(4, this)" id="btn-pos-4">4. Vpravo</div>
                    </div>
                    <div class="layout-item pos-list" onclick="selectPosition(0, this)" id="btn-pos-0">Běžný seznam (automaticky)</div>
                </div>
                <p style="font-size:12px; color:var(--muted); margin-top:8px;">Pokud vyberete obsazenou pozici, původní článek spadne do seznamu.</p>
            </div>
            {% endif %}
        </div>

        <div>
            <label style="display:block; font-weight:700; margin-bottom:8px;">Perex (krátký úvod)</label>
            <textarea name="perex" rows="3" required
                      style="width:100%; padding:12px; border:1px solid var(--border); border-radius:6px; background:var(--bg); color:var(--text);">{{ article.perex if article else '' }}</textarea>
        </div>

        <div>
            <label style="display:block; font-weight:700; margin-bottom:8px;">Obsah článku (HTML)</label>
            <textarea name="content" rows="15" required
                      style="width:100%; padding:12px; border:1px solid var(--border); border-radius:6px; background:var(--bg); color:var(--text); font-family:monospace;">{{ article.content if article else '' }}</textarea>
            <p style="font-size:12px; color:var(--muted); margin-top:4px;">Zde můžeš psát HTML tagy (např. &lt;p&gt;, &lt;h2&gt;, &lt;b&gt;).</p>
        </div>

        <div style="margin-top:20px;">
            <button type="submit" style="background:var(--blue); color:white; padding:14px 30px; border:0; border-radius:6px; font-weight:700; font-size:16px; cursor:pointer;">
                {% if article %}Uložit změny{% else %}Uložit článek{% endif %}
            </button>
        </div>

    </form>
</div>

<style>
    .layout-grid { display: flex; flex-direction: column; gap: 10px; max-width: 400px; }
    .layout-row { display: flex; gap: 10px; }
    .layout-item {
        border: 2px dashed #ccc; border-radius: 4px; 
        display: flex; align-items: center; justify-content: center;
        font-size: 13px; font-weight: 600; color: #666;
        cursor: pointer; transition: all 0.2s;
        background: #f9f9f9;
    }
    .layout-item:hover { border-color: var(--blue); color: var(--blue); }
    .layout-item.active { background: var(--blue); color: white; border-style: solid; border-color: var(--blue); }
    .pos-main { height: 80px; width: 100%; font-size: 16px; }
    .pos-sec { height: 60px; flex: 1; text-align: center; }
    .pos-list { height: 40px; width: 100%; border-style: solid; border-color: #eee; }
</style>

<script>
    function togglePositionSelector() {
        const status = document.getElementById('statusSelect').value;
        const wrapper = document.getElementById('positionSelectorWrapper');
        if (wrapper) {
            wrapper.style.display = (status === 'published') ? 'block' : 'none';
        }
    }

    function selectPosition(posId, element) {
        document.querySelectorAll('.layout-item').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        document.getElementById('home_position').value = posId;
    }

    window.addEventListener('DOMContentLoaded', () => {
        togglePositionSelector();
        const posInput = document.getElementById('home_position');
        if (posInput) {
            const currentPos = parseInt(posInput.value);
            const btn = document.getElementById('btn-pos-' + currentPos);
            if (btn) btn.classList.add('active');
        }
    });
</script>
{% endblock %}