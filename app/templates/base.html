<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Zprávy.cz{% endblock %}</title>

    <link rel="icon" type="image/png" href="{{ url_for('static', path='/img/zpravyCzFavicon.png') }}" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&subset=latin,latin-ext&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}">
</head>
<body>
 <header class="site-header">
        <div class="header-inner">
            <div class="logo-wrap">
                <a href="/" style="text-decoration:none">
                    <img id="siteLogo" class="site-logo" src="{{ url_for('static', path='/img/zpravyczLogo.png') }}" alt="zprávy.cz logo" />
                </a>
            </div>

            <div class="header-date" id="currentDate">Dnes je ...</div>

            <div style="display:flex; align-items:center; gap:4px; position:relative;">
                
                <div class="search-wrapper">
                    <form action="/hledat" method="get" class="search-form" id="searchForm">
                        <input type="text" name="q" class="search-input" placeholder="Hledat..." autocomplete="off" id="searchInput">
                    </form>

                    <button id="searchToggle" class="search-toggle" aria-label="Hledat">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="10" cy="10" r="7"></circle>
                            <line x1="21" y1="21" x2="15" y2="15"></line>
                        </svg>
                    </button>
                </div>

                <button id="themeToggle" class="theme-toggle" aria-label="Přepnout motiv">
                    <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M12 17q-2.075 0-3.538-1.463T7 12q0-2.075 1.463-3.538T12 7q2.075 0 3.538 1.463T17 12q0 2.075-1.463 3.538T12 17ZM2 13q-.425 0-.713-.288T1 12q0-.425.288-.713T2 11h2q.425 0 .713.288T5 12q0 .425-.288.713T4 13H2Zm18 0q-.425 0-.713-.288T19 12q0-.425.288-.713T20 11h2q.425 0 .713.288T23 12q0 .425-.288.713T22 13h-2Zm-8-8q-.425 0-.713-.288T11 4V2q0-.425.288-.713T12 1q.425 0 .713.288T13 2v2q0 .425-.288.713T12 5Zm0 18q-.425 0-.713-.288T11 22v-2q0-.425.288-.713T12 19q.425 0 .713.288T13 20v2q0 .425-.288.713T12 23ZM5.65 7.05L4.575 6q-.3-.275-.288-.7t.288-.725q.3-.3.725-.3t.7.3L7.05 5.65q.275.3.275.7t-.275.7q-.275.3-.687.288T5.65 7.05ZM18 19.425l-1.05-1.075q-.275-.3-.275-.713t.275-.687q.275-.3.688-.287t.712.287L19.425 18q.3.275.288.7t-.288.725q-.3.3-.725.3t-.7-.3ZM16.95 7.05q-.3-.275-.288-.687t.288-.713L18 4.575q.275-.3.7-.288t.725.288q.3.3.3.725t-.3.7L18.35 7.05q-.3.275-.7.275t-.7-.275ZM4.575 19.425q-.3-.3-.3-.725t.3-.7l1.075-1.05q.3-.275.712-.275t.688.275q.3.275.288.688t-.288.712L6 19.425q-.275.3-.7.288t-.725-.288Z"/>
                    </svg>
                </button>

                {% if user %}
                    <div class="signin-wrap">
                        <button id="userBtn" class="signin-btn">{{ user.name }} ▾</button>
                        <div id="userDropdown" class="dropdown-content" style="width: 200px;">
                            <a href="/oblibene" class="user-menu-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:text-bottom; margin-right:8px; "><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                Oblíbené články
                            </a>
                            {% if user.role == 'admin' or user.role == 'editor' or user.role == 'chief_editor' %}
                                <a href="/admin/clanky" class="user-menu-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:text-bottom; margin-right:6px;"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                    Správa článků
                                </a>
                            {% endif %}
                            {% if user.role == 'admin' %}
                                <a href="/admin/uzivatele" class="user-menu-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:text-bottom; margin-right:6px;"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                                    Správa uživatelů
                                </a>
                            {% endif %}
                            <a href="/logout?next={{ request.url.path }}" class="user-menu-item logout">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block; vertical-align:text-bottom; margin-right:6px;"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                Odhlásit se
                            </a>
                        </div>
                    </div>
                {% else %}
                    <div class="signin-wrap">
                        <button id="signinBtn" class="signin-btn">Přihlásit ▾</button>
                        <div id="signinDropdown" class="dropdown-content">
                            
                            <div id="loginFormWrapper">
                                <h3 style="margin:0 0 12px 0; font-size:16px; font-weight:700">Přihlášení</h3>
                                
                                <div id="loginError" style="display:none; color:red; font-size:13px; margin-bottom:10px; background:rgba(255,0,0,0.1); padding:8px; border-radius:4px;">
                                    Špatný email nebo heslo.
                                </div>

                                <form action="/login" method="post">
                                    <input type="hidden" name="next" value="{{ request.url.path }}">
                                    
                                    <input type="email" name="username" placeholder="Email" required />
                                    <input type="password" name="password" placeholder="Heslo" required />
                                    <button type="submit">Přihlásit</button>
                                </form>
                                <div class="register-link">
                                    Nemáte účet? <a href="#" id="showRegisterBtn">Zaregistrujte se</a>
                                </div>
                            </div>

                            <div id="registerFormWrapper" style="display:none">
                                <h3 style="margin:0 0 12px 0; font-size:16px; font-weight:700">Registrace</h3>
                                <form action="/registrace" method="post">
                                    <input type="hidden" name="next" value="{{ request.url.path }}">

                                    <input type="text" name="name" placeholder="Celé jméno" required />
                                    <input type="email" name="email" placeholder="Email" required />
                                    <input type="password" name="password" placeholder="Heslo" required />
                                    <button type="submit">Vytvořit účet</button>
                                </form>
                                <div class="register-link">
                                    Už máte účet? <a href="#" id="showLoginBtn">Přihlásit se</a>
                                </div>
                            </div>

                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </header>

    <main>
        {% block content %}{% endblock %}
    </main>

    <script>
        // --- LOGO & IKONY ---
        const logoLight = "{{ url_for('static', path='/img/zpravyczlogo.png') }}";
        const logoDark = "{{ url_for('static', path='/img/zpravyCzLogoDark.png') }}";
        const sunIcon = '<path d="M12 17q-2.075 0-3.538-1.463T7 12q0-2.075 1.463-3.538T12 7q2.075 0 3.538 1.463T17 12q0 2.075-1.463 3.538T12 17ZM2 13q-.425 0-.713-.288T1 12q0-.425.288-.713T2 11h2q.425 0 .713.288T5 12q0 .425-.288.713T4 13H2Zm18 0q-.425 0-.713-.288T19 12q0-.425.288-.713T20 11h2q.425 0 .713.288T23 12q0 .425-.288.713T22 13h-2Zm-8-8q-.425 0-.713-.288T11 4V2q0-.425.288-.713T12 1q.425 0 .713.288T13 2v2q0 .425-.288.713T12 5Zm0 18q-.425 0-.713-.288T11 22v-2q0-.425.288-.713T12 19q.425 0 .713.288T13 20v2q0 .425-.288.713T12 23ZM5.65 7.05L4.575 6q-.3-.275-.288-.7t.288-.725q.3-.3.725-.3t.7.3L7.05 5.65q.275.3.275.7t-.275.7q-.275.3-.687.288T5.65 7.05ZM18 19.425l-1.05-1.075q-.275-.3-.275-.713t.275-.687q.275-.3.688-.287t.712.287L19.425 18q.3.275.288.7t-.288.725q-.3.3-.725.3t-.7-.3ZM16.95 7.05q-.3-.275-.288-.687t.288-.713L18 4.575q.275-.3.7-.288t.725.288q.3.3.3.725t-.3.7L18.35 7.05q-.3.275-.7.275t-.7-.275ZM4.575 19.425q-.3-.3-.3-.725t.3-.7l1.075-1.05q.3-.275.712-.275t.688.275q.3.275.288.688t-.288.712L6 19.425q-.275.3-.7.288t-.725-.288Z"/>';
        const moonIcon = '<path d="M9 3q1.868 0 3.51.708q1.643.709 2.857 1.924q1.215 1.214 1.924 2.856Q18 10.13 18 11.997q0 1.866-.709 3.51t-1.923 2.859q-1.215 1.216-2.858 1.925Q10.867 21 9 21q-.789 0-1.54-.136q-.752-.135-1.46-.445q1.902-1.561 2.951-3.756Q10 14.47 10 12T8.951 7.337Q7.901 5.142 6 3.58q.708-.31 1.46-.445Q8.21 3 9 3Z"/>';

        // --- DATUM ---
        const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        let dateString = new Date().toLocaleDateString('cs-CZ', dateOptions);
        document.getElementById('currentDate').textContent = dateString.charAt(0).toUpperCase() + dateString.slice(1);

        // --- SVĚTLÝ/TMAVÝ REŽIM ---
        const htmlEl = document.documentElement;
        const toggleBtn = document.getElementById('themeToggle');
        const themeIconSvg = document.getElementById('themeIcon');
        const siteLogo = document.getElementById('siteLogo');
        const currentTheme = localStorage.getItem('theme') || 'light';
        
        htmlEl.setAttribute('data-theme', currentTheme);
        siteLogo.src = currentTheme === 'dark' ? logoDark : logoLight;
        themeIconSvg.innerHTML = currentTheme === 'dark' ? moonIcon : sunIcon;

        toggleBtn.addEventListener('click', () => {
            const current = htmlEl.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            htmlEl.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            siteLogo.src = next === 'dark' ? logoDark : logoLight;
            themeIconSvg.innerHTML = next === 'dark' ? moonIcon : sunIcon;
        });

        // --- DROPDOWN LOGIKA ---
        function setupDropdown(btnId, dropdownId) {
            const btn = document.getElementById(btnId);
            const dropdown = document.getElementById(dropdownId);
            
            if (btn && dropdown) {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    document.querySelectorAll('.dropdown-content').forEach(d => {
                        if (d !== dropdown) d.classList.remove('show');
                    });
                    dropdown.classList.toggle('show');
                });
            }
        }

        setupDropdown('signinBtn', 'signinDropdown');
        setupDropdown('userBtn', 'userDropdown');

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.signin-wrap')) {
                document.querySelectorAll('.dropdown-content').forEach(d => d.classList.remove('show'));
            }
        });

        // Přepínač Login/Register
        const showRegisterBtn = document.getElementById('showRegisterBtn');
        const showLoginBtn = document.getElementById('showLoginBtn');
        const loginWrapper = document.getElementById('loginFormWrapper');
        const registerWrapper = document.getElementById('registerFormWrapper');

        if (showRegisterBtn) {
            showRegisterBtn.addEventListener('click', (e) => {
                e.preventDefault();
                loginWrapper.style.display = 'none';
                registerWrapper.style.display = 'block';
            });
        }
        if (showLoginBtn) {
            showLoginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                registerWrapper.style.display = 'none';
                loginWrapper.style.display = 'block';
            });
        }

        // --- DETEKCE CHYBY PŘIHLÁŠENÍ ---
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('error')) {
            const dropdown = document.getElementById('signinDropdown');
            const errorMsg = document.getElementById('loginError');
            if (dropdown && errorMsg) {
                dropdown.classList.add('show');
                errorMsg.style.display = 'block';
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // --- VYHLEDÁVÁNÍ ---
        const searchBtn = document.getElementById('searchToggle');
        const searchForm = document.getElementById('searchForm');
        const searchInput = document.getElementById('searchInput');

        if (searchBtn && searchForm) {
            searchBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Aby se hned nezavřelo
                const isActive = searchForm.classList.contains('active');
                
                if (isActive) {
                    searchForm.classList.remove('active');
                } else {
                    searchForm.classList.add('active');
                    searchInput.focus();
                }
            });

            // Zavřít když kliknu mimo
            document.addEventListener('click', (e) => {
                if (searchForm.classList.contains('active')) {
                    if (!searchForm.contains(e.target) && !searchBtn.contains(e.target)) {
                        searchForm.classList.remove('active');
                    }
                }
            });
        }
    </script>
</body>
</html>